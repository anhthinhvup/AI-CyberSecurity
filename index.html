<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cyber Attacker Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="logo">üõ°Ô∏è</div>
        <div class="title">AI Cyber Attacker Dashboard</div>
        <div class="status" id="api-status">API: <span class="offline">Offline</span></div>
    </header>
    <div class="container">
        <div class="left-panel">
            <form id="attack-form">
                <h2>Kh·ªüi ƒë·ªông Attack</h2>
                <label>üéØ Target<br><input type="text" id="target" value="127.0.0.1:5000" autocomplete="off"></label>
                <label>üß† Mode<br>
                    <select id="mode">
                        <option value="training">Training</option>
                        <option value="evaluation">Evaluation</option>
                    </select>
                </label>
                <button type="submit" id="run-btn">üöÄ Kh·ªüi ƒë·ªông</button>
            </form>
            <div class="attack-status" id="attack-status">Ch∆∞a ch·∫°y attack.</div>
            <div class="guide">
                <h3>H∆∞·ªõng d·∫´n</h3>
                <ul>
                    <li>Nh·∫≠p target (IP/Domain)</li>
                    <li>Ch·ªçn mode (training/evaluation)</li>
                    <li>Nh·∫•n <b>Kh·ªüi ƒë·ªông</b></li>
                    <li>Xem log, k·∫øt qu·∫£</li>
                </ul>
            </div>
        </div>
        <div class="right-panel">
            <div class="log-container" id="log-container"></div>
            <div class="result-container" id="result-container"></div>
            <button id="export-report-btn" style="margin-top:16px;padding:10px 24px;background:#4caf50;color:#18181a;border:none;border-radius:6px;cursor:pointer;font-weight:bold;">Xu·∫•t b√°o c√°o</button>
        </div>
    </div>
    <footer class="footer">
        ¬© 2024 AI Cyber Attacker | Dashboard by <a href="#" target="_blank">YourName</a>
    </footer>
    <script>
        // API status check
        async function checkAPI() {
            try {
                await fetch('http://localhost:5005/attack_log');
                document.getElementById('api-status').innerHTML = 'API: <span class="online">Online</span>';
            } catch {
                document.getElementById('api-status').innerHTML = 'API: <span class="offline">Offline</span>';
            }
        }
        checkAPI();
        setInterval(checkAPI, 5000);

        // Render log
        function renderLog(logs) {
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = logs.map(l => `<div class='log-line'>${l}</div>`).join('');
        }

        // Th√™m popup nh·∫≠p n·ªôi dung XSS tu·ª≥ ch·ªânh
        function showXssPopup(callback) {
            let popup = document.createElement('div');
            popup.style.position = 'fixed';
            popup.style.top = '0';
            popup.style.left = '0';
            popup.style.width = '100vw';
            popup.style.height = '100vh';
            popup.style.background = 'rgba(0,0,0,0.7)';
            popup.style.display = 'flex';
            popup.style.alignItems = 'center';
            popup.style.justifyContent = 'center';
            popup.style.zIndex = '9999';
            popup.innerHTML = `
                <div style="background:#232326;padding:32px 28px;border-radius:12px;box-shadow:0 2px 16px #000a;min-width:320px;max-width:90vw;">
                    <h2 style='color:#4caf50;margin-bottom:16px;'>Khai th√°c XSS tu·ª≥ ch·ªânh</h2>
                    <div style='color:#c8ffc8;margin-bottom:10px;'>Nh·∫≠p n·ªôi dung b·∫°n mu·ªën ch√®n v√†o v·ªã tr√≠ XSS (c√≥ th·ªÉ l√† script, HTML, text...)</div>
                    <textarea id='xss-content' style='width:100%;height:80px;background:#18181a;color:#c8ffc8;border:1.5px solid #4caf50;border-radius:6px;padding:8px;font-size:1rem;'></textarea>
                    <div style='margin-top:18px;display:flex;gap:12px;justify-content:flex-end;'>
                        <button id='xss-cancel' style='padding:8px 18px;background:#222;color:#fff;border:none;border-radius:6px;cursor:pointer;'>Hu·ª∑</button>
                        <button id='xss-ok' style='padding:8px 18px;background:#4caf50;color:#18181a;border:none;border-radius:6px;cursor:pointer;font-weight:bold;'>Khai th√°c</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
            document.getElementById('xss-cancel').onclick = () => document.body.removeChild(popup);
            document.getElementById('xss-ok').onclick = () => {
                const val = document.getElementById('xss-content').value;
                document.body.removeChild(popup);
                callback(val);
            };
        }

        // S·ª≠a renderResult ƒë·ªÉ ph√°t hi·ªán XSS v√† hi·ªÉn th·ªã n√∫t khai th√°c tu·ª≥ ch·ªânh
        function renderResult(result) {
            const resultContainer = document.getElementById('result-container');
            if (!result) { resultContainer.innerHTML = ''; return; }
            let html = `<h3>K·∫øt qu·∫£ t·∫•n c√¥ng:</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
            // N·∫øu c√≥ XSS, hi·ªÉn th·ªã n√∫t khai th√°c tu·ª≥ ch·ªânh
            if (result && result.vulnerabilities && result.vulnerabilities.some(v => v.type === 'xss')) {
                html += `<button id='custom-xss-btn' style='margin-top:12px;padding:8px 18px;background:#4caf50;color:#18181a;border:none;border-radius:6px;cursor:pointer;font-weight:bold;'>Khai th√°c XSS tu·ª≥ ch·ªânh</button>`;
            }
            resultContainer.innerHTML = html;
            // G·∫Øn s·ª± ki·ªán cho n√∫t
            const btn = document.getElementById('custom-xss-btn');
            if (btn) {
                btn.onclick = () => {
                    showXssPopup(async (content) => {
                        if (!content) return;
                        renderStatus('ƒêang khai th√°c XSS tu·ª≥ ch·ªânh...', 'running');
                        const res = await fetch('http://localhost:5005/custom_xss_exploit', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ content })
                        });
                        const data = await res.json();
                        let msg = `<div style='margin-top:10px;'><b>K·∫øt qu·∫£ XSS tu·ª≥ ch·ªânh:</b><br><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                        resultContainer.innerHTML += msg;
                        renderStatus('Khai th√°c XSS tu·ª≥ ch·ªânh ho√†n th√†nh.', 'done');
                    });
                };
            }
        }

        // Render status
        function renderStatus(text, type='info') {
            const el = document.getElementById('attack-status');
            el.className = 'attack-status ' + type;
            el.innerText = text;
        }

        // G·ªçi API Flask khi submit form
        document.getElementById('attack-form').onsubmit = async function(e) {
            e.preventDefault();
            const target = document.getElementById('target').value;
            const mode = document.getElementById('mode').value;
            renderLog(['[INFO] Initializing...']);
            renderResult(null);
            renderStatus('ƒêang ch·∫°y attack...', 'running');
            // G·ª≠i request kh·ªüi ƒë·ªông attack
            await fetch('http://localhost:5005/attack', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ target, mode })
            });
            pollLogAndResult();
        };

        // Poll log v√† k·∫øt qu·∫£ li√™n t·ª•c
        let pollInterval = null;
        function pollLogAndResult() {
            if (pollInterval) clearInterval(pollInterval);
            pollInterval = setInterval(async () => {
                const logRes = await fetch('http://localhost:5005/attack_log');
                const logData = await logRes.json();
                renderLog(logData.log || []);
                // K·∫øt qu·∫£
                const resultRes = await fetch('http://localhost:5005/attack_result');
                const resultData = await resultRes.json();
                renderResult(resultData.result);
                if (logData.running === false) {
                    clearInterval(pollInterval);
                    renderStatus('Attack ƒë√£ ho√†n th√†nh.', 'done');
                }
            }, 1000);
        }

        document.getElementById('export-report-btn').onclick = function() {
            fetch('http://localhost:5005/export_report')
                .then(response => {
                    if (!response.ok) throw new Error('Kh√¥ng th·ªÉ xu·∫•t b√°o c√°o!');
                    return response.blob();
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'bao_cao_ai_attacker.adoc';
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                })
                .catch(() => alert('Kh√¥ng th·ªÉ xu·∫•t b√°o c√°o!'));
        };
    </script>
</body>
</html> 